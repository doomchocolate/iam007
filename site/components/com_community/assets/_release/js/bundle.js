define("sandbox",[],function(){function t(t,i){return e(t,i)}var e=window.joms.jQuery,i=window._,s=window.Backbone;s.$=e,i.pick(i,["each","filter","intersection","without","bind","debounce","defer","keys","extend","pick","omit","isArray","isNumber","isString","isUndefined","uniqueId"]),i.extend(t,s.Events,i,{mvc:{Model:s.Model,Models:s.Collection,View:s.View},ajax:e.ajax,param:e.param,noop:function(){}}),t.__extend=t.extend,t._$extend=e.extend,t.extend=function(){var e=arguments[0]===!0;return t[e?"_$extend":"__extend"].apply(null,arguments)},t.ua=navigator.userAgent;var o=t.ua.toLowerCase();return t.mobile=!!o.match(/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i),t.webkit=!!o.match(/webkit/i),t.ie=!!o.match(/msie/i),t.ieVersion=t.ie&&+o.match(/msie (\d+)\./i)[1],t.xpriment=!t.ie&&1,t(document.body).on("click",function(e){t.trigger("click",t(e.target))}),t}),define("views/base",["sandbox"],function(t){return t.mvc.View.extend({assign:function(e,i){t.isArray(e)||(e=[[e,i]]),t.each(e,function(t){t[1].setElement(t[0]).render()})},show:function(){this.isHidden()&&(this.$el.show(),this.trigger("show"))},hide:function(){this.isHidden()||(this.$el.hide(),this.trigger("hide"))},toggle:function(){this.isHidden()?this.show():this.hide()},isHidden:function(){return"none"===this.el.style.display}})}),define("app",[],function(){var t;return t=require.toUrl(""),t=t.replace(/js\/$/,""),t=t.replace(/\?.+$/,""),{baseUrl:"",staticUrl:t,legacyUrl:t+"../../"}}),define("utils/ajax",["sandbox"],function(t){function e(e){return e=t.extend({},s,e||{}),e.url=window.jax_live_site,e.data=i(e.fn,e.data),t.ajax(e)}function i(e,i){var s={};s.option="community",s.no_html=1,s.task="azrul_ajax",s.func=e,s[window.jax_token_var]=1,t.isArray(i)||(i=[]);for(var o,n=0;n<i.length;n++)o=i[n],t.isString(o)&&(o=o.replace(/"/g,"&quot;")),t.isArray(o)||(o=["_d_",o]),s["arg"+(n+2)]=JSON.stringify(o);return s}var s={type:"post",data:{},dataType:"json",error:t.noop,success:t.noop,complete:t.noop};return e}),define("utils/constants",["sandbox"],function(t){function e(e){if("string"==typeof e&&e.length){joms&&joms.constants&&(t.extend(!0,i,joms&&joms.constants),delete joms.constants);var s=i;for(e=e.split(".");e.length;)s=s[e.shift()];return s}}var i={};return{get:e}}),define("views/postbox/default",["sandbox","app","views/base","utils/ajax","utils/constants"],function(t,e,i,s,o){return i.extend({subviews:{},template:function(){throw new Error("Method not implemented.")},events:{"click li[data-tab]":"onToggleDropdown","click button.joms-postbox-cancel":"onCancel","click button.joms-postbox-save":"onPost"},initialize:function(t){t&&t.single&&(this.single=!0),this.subflags={},this.reset()},render:function(){var t=this.getTemplate();return this.$el.replaceWith(t),this.setElement(t),this.$tabs=this.$(".joms-postbox-tab"),this.$action=this.$(".joms-postbox-action").hide(),this.$loading=this.$(".joms-postbox-loading").hide(),this.$save=this.$(".joms-postbox-save").hide(),this},show:function(){this.showInitialState(),i.prototype.show.apply(this)},showInitialState:function(){this.reset(),this.$tabs.hide(),this.$action.hide(),this.$save.hide(),this.trigger("show:initial")},showMainState:function(){this.$tabs.show(),this.$action.show(),this.trigger("show:main")},reset:function(){this.data={},this.data.text="",this.data.attachment={};for(var t in this.subflags)this.subviews[t].reset(),this.subviews[t].hide()},value:function(e){var i=t.extend({},this.getStaticAttachment(),this.data.attachment);return[this.data.text,e?i:JSON.stringify(i)]},validate:t.noop,onToggleDropdown:function(e){var i=t(e.currentTarget);if(!i.data("bypass")){var s=i.data("tab");if(this.subviews[s]){if(this.subflags[s]||this.initSubview(s),!this.subviews[s].isHidden())return this.subviews[s].hide(),void 0;for(var o in this.subflags)o!==s&&this.subviews[o].hide();this.subviews[s].show()}}},onCancel:function(){e.postbox&&e.postbox.value&&(e.postbox.value=!1),this.saving||this.showInitialState()},onPost:function(){if(!this.saving){var e=this.validate();if(e)return window.alert(e),void 0;this.saving=!0,this.$loading.show();var i=this;s({fn:"system,ajaxStreamAdd",data:this.value(),success:t.bind(this.onPostSuccess,this),complete:function(){i.$loading.hide(),i.saving=!1,i.showInitialState()}})}},onPostSuccess:function(e){var i,s=this.parseResponse(e);if(s){i=t("#activity-stream-container"),i.html(s);var o=t(".joms-activity-filter-action .joms-activity-filter-status");o&&o.length&&o.html(o.data("default"))}},initSubview:function(t,e){var i=t.replace(/^./,function(t){return t.toUpperCase()});this.subflags[t]||(this.subviews[t]=new this.subviews[t](e),this.assign(this.getSubviewElement(),this.subviews[t]),this.listenTo(this.subviews[t],"init",this["on"+i+"Init"]),this.listenTo(this.subviews[t],"show",this["on"+i+"Show"]),this.listenTo(this.subviews[t],"hide",this["on"+i+"Hide"]),this.listenTo(this.subviews[t],"select",this["on"+i+"Select"]),this.listenTo(this.subviews[t],"remove",this["on"+i+"Remove"]),this.subflags[t]=!0)},getSubviewElement:function(){var e=t("<div>").hide().appendTo(this.$el);return e},parseResponse:function(t){var e,i="activity-stream-container";if(t&&t.length)for(var s=0;s<t.length;s++)if(t[s][1]===i){e=t[s][3];break}return e},getTemplate:function(){var e=this.template({juri:o.get("juri")});return t(e).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},o.get("postbox.attachment")||{},{type:""}),this.staticAttachment)}})}),define("utils/image",[],function(){function t(t,e){this.images=[],this.loaded=[],this.processed=0,this.callback=e,t&&t.length||(t=[]);for(var i=/^(http:|https:)?\/\/([a-z0-9-]+\.)+[a-z]{2,4}\/.*$/i,s=0;s<t.length;s++)t[s].match(i)&&this.images.push(t[s])}function e(e,i){var s=new t(e,i);s.load()}return t.prototype.load=function(){if(!this.images||!this.images.length)return this.callback([]),void 0;for(var t,e=0;e<this.images.length;e++)t=new Image,t.onload=this.onload,t.onerror=this.onerror,t.onabort=this.onabort,t.preloader=this,t.src=this.images[e]},t.prototype.onload=function(){this.preloader.loaded.push(this.src),this.preloader.oncomplete()},t.prototype.onerror=function(){this.preloader.oncomplete()},t.prototype.onabort=function(){this.preloader.oncomplete()},t.prototype.oncomplete=function(){var t,e=[];if(this.processed++,this.processed>=this.images.length){for(t=0;t<this.images.length;t++)this.loaded.indexOf(this.images[t])>-1&&e.push(this.images[t]);this.callback(e)}},{preload:e}}),define("utils/language",["sandbox"],function(t){function e(e){if("string"==typeof e&&e.length){joms&&joms.language&&(t.extend(!0,i,joms&&joms.language),delete joms.language);var s=i;for(e=e.split(".");e.length;)s=s[e.shift()];return s}}var i={};return{get:e}}),define("views/postbox/fetcher",["sandbox","views/base","utils/ajax","utils/image","utils/language"],function(t,e,i,s,o){return e.extend({template:joms.jst["html/postbox/fetcher"],events:{"click .joms-fetched-close":"onClose","click .joms-fetched-field span":"onFocus","keyup .joms-fetched-field input":"onKeyup","keyup .joms-fetched-field textarea":"onKeyup","blur .joms-fetched-field input":"onBlur","blur .joms-fetched-field textarea":"onBlur","click .joms-fetched-previmg":"prevImage","click .joms-fetched-nextimg":"nextImage"},initialize:function(){var t=o.get("fetch")||{};this.titlePlaceholder=t.title_hint||"",this.descPlaceholder=t.description_hint||""},fetch:function(e){var s=/^(|.*\s)(https?:\/\/|www\.)([a-z0-9-]+\.)+[a-z]{2,4}(:\d+)?(\/.*)?(\s.*|)$/i,o=e.match(s);!this.fetching&&o&&(this.fetching=!0,this.fetched=!1,delete this.url,this.trigger("fetch:start"),i({fn:"system,ajaxGetFetchUrl",data:[e],success:t.bind(this.render,this),complete:t.noop}))},render:function(e){if(e=e&&e[2]&&e[2][3]&&e[2][3][0]||!1){var i;try{i=JSON.parse(e)}catch(o){}if(i){this.fetched=!0,this.url=i.url||"";var n={title:i.title||"",titlePlaceholder:this.titlePlaceholder,description:i.description||"",descPlaceholder:this.descPlaceholder,image:i.image||[]};this.url.match(/^https?:\/\//i)||(this.url="http://"+this.url);for(var a=0;a<n.image.length;a++)n.image[a].match(/^(http:|https:)?\/\//i)||(n.image[a]="//"+n.image[a]);s.preload(n.image,t.bind(function(t){n.image=t,this.$el.html(this.template(n)),this.$images=this.$(".joms-fetched-images").find("img"),this.$title=this.$(".joms-fetched-title").find("input"),this.$description=this.$(".joms-fetched-description").find("textarea"),this.fetching=!1,this.trigger("fetch:done")},this))}}},change:function(e){var i=t(e),s=i.prev("span"),o=i.val().replace(/^\s+|\s+$/g,"");o||(o=i.parent().hasClass("joms-fetched-title")?this.titlePlaceholder:this.descPlaceholder),i.hide(),s.text(o).show()},remove:function(){delete this.url,e.prototype.remove.apply(this),this.trigger("remove")},prevImage:function(){var t=this.$images.filter(":visible"),e=t.prev();e.length&&(t.hide(),e.show())},nextImage:function(){var t=this.$images.filter(":visible"),e=t.next();e.length&&(t.hide(),e.show())},value:function(){return this.fetching?[]:[this.url,this.$images&&this.$images.filter(":visible").attr("src"),this.$title&&this.$title.val().replace(/\t/g,"\\t").replace(/\n/g,"\\n"),this.$description&&this.$description.val().replace(/\t/g,"\\t").replace(/\n/g,"\\n")]},onClose:function(){this.remove()},onFocus:function(e){var i=t(e.currentTarget),s=i.next("input,textarea");i.hide(),s.show(),setTimeout(function(){s[0].focus()},300)},onKeyup:function(t){13===t.keyCode&&this.change(t.currentTarget)},onBlur:function(t){this.change(t.currentTarget)},parseResponse:function(t){if(t=t&&t[2]&&t[2][3]&&t[2][3][0]||!1){var e;try{e=JSON.parse(t)}catch(i){}return e}}})}),define("views/inputbox/base",["sandbox","views/base","utils/constants"],function(t,e,i){return e.extend({events:{"focus textarea":"onFocus","keydown textarea":"onKeydownProxy","input textarea":"onInput","paste textarea":"onPaste","blur textarea":"onBlur"},initialize:function(e){t.mobile||(this.onInput=t.noop,this.onKeydownProxy=this.onKeydown,this.updateCharCounterProxy=this.updateCharCounter),e||(e={}),this.flags={},this.flags.attachment=e.attachment,this.flags.charcount=e.charcount,this.listenTo(t,"postbox:tab:change",this.reset)},render:function(){this.$mirror=this.$("span.input"),this.$textarea=this.$("textarea.input"),this.placeholder=this.$textarea.attr("placeholder"),this.flags.attachment&&(this.$attachment=t("<span class=attachment>").insertAfter(this.$mirror)),this.reset()},set:function(t){this.$textarea.val(t),this.flags.attachment&&this.updateAttachment(),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},reset:function(){this.$textarea.val(""),this.flags.attachment&&this.updateAttachment(),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},value:function(){return this.$textarea[0].value},onFocus:function(){this.trigger("focus")},onKeydown:function(e){var i=this;t.defer(function(){i.updateInput(e)})},onKeydownProxy:t.debounce(function(t){this.onKeydown(t)},10),onInput:function(){this.onKeydownProxy()},onPaste:function(){var t=this;this.onKeydownProxy(function(){t.trigger("paste",t.$textarea[0].value,13)})},onBlur:function(){this.trigger("blur",this.$textarea[0].value,13)},updateInput:function(t){var e=t&&t.keyCode||!1,i=this.$textarea[0],s=i.value,o=""===s.replace(/^\s+|\s+$/g,"");o&&(i.value=s=""),this.$mirror.html(this.normalize(s)+"."),this.$textarea.css("height",this.$mirror.height()),this.flags.charcount&&this.updateCharCounterProxy(),this.trigger("keydown",s,e),"function"==typeof t&&t()},updateAttachment:t.noop,updateCharCounterProxy:t.debounce(function(){this.updateCharCounter()},300),updateCharCounter:function(){return"undefined"==typeof this.maxchar&&(this.maxchar=+i.get("conf.statusmaxchar")||0),this.$charcount||(this.$charcount=this.$(".charcount")),!this.maxchar||this.maxchar<=0?(this.$charcount.hide(),void 0):(this.$charcount.html(this.maxchar-this.$textarea[0].value.length).show(),void 0)},normalize:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")},resetTextntags:function(e,s){var o=this;e=t(e),e.data("initialized")||(e.data("initialized",1),e.textntags({triggers:{"@":{uniqueTags:!0,minChars:1}},onDataRequest:function(e,s,n,a){var h="index.php?option=com_community&view=friends&task=ajaxAutocomplete",r=i.get("settings");r.isGroup?h+="&groupid="+i.get("groupid"):r.isEvent&&(h+="&eventid="+i.get("eventid")),o.fetchTextntags&&o.fetchTextntags.abort(),o.fetchTextntags=t.ajax({url:h+"&query="+s,dataType:"json",success:function(e){var i,o=[];if(e&&e.suggestions&&e.suggestions.length){for(i=0;i<e.suggestions.length;i++)o.push({id:e.data[i],name:e.suggestions[i],avatar:e.img[i].replace(/^.+src="([^"]+)".+$/,"$1"),type:"contact"});s=s.toLowerCase(),o=t.filter(o,function(t){return t.name.toLowerCase().indexOf(s)>-1}),a.call(this,o)}},complete:function(){o.fetchTextntags=!1}})}}).bind("tagsAdded.textntags",function(){o.updateInput()}).bind("tagsRemoved.textntags",function(){o.updateInput()})),e.textntags("val",s)}})}),define("views/inputbox/status",["sandbox","views/inputbox/base","utils/constants","utils/language"],function(t,e,i,s){return e.extend({template:joms.jst["html/inputbox/status"],initialize:function(){e.prototype.initialize.apply(this,arguments),this.language=s.get("mood")},render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},set:function(t){this.resetTextntags(this.$textarea,t),this.flags.attachment&&this.updateAttachment(!1,!1),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},reset:function(){this.resetTextntags(this.$textarea,""),this.flags.attachment&&this.updateAttachment(!1,!1),this.flags.charcount&&this.updateCharCounterProxy(),this.onKeydownProxy()},value:function(){return this.textareaValue},updateInput:function(){e.prototype.updateInput.apply(this,arguments);var t=this;this.$textarea.textntags("val",function(e){t.textareaValue=e})},updateAttachment:function(t,e){var i=[];return this.mood=t||t===!1?t:this.mood,this.location=e||e===!1?e:this.location,this.location&&this.location.name&&i.push("<b>at "+this.location.name+"</b>"),this.mood&&i.push('<i class="joms-emoticon joms-emo-'+this.mood+'"></i> <b>'+(this.language[this.mood]||this.mood)+"</b>"),i.length?(this.$attachment.html(" &nbsp;&mdash; "+i.join(" and ")+"."),this.$textarea.removeAttr("placeholder"),void 0):(this.$attachment.html(""),this.$textarea.attr("placeholder",this.placeholder),void 0)},getTemplate:function(){var e=s.get("status.status_hint")||"",i=this.template({placeholder:e});return t(i)}})}),define("views/dropdown/base",["sandbox","views/base"],function(t,e){return e.extend({initialize:function(){this.listenTo(t,"click",this._onDocumentClick)},_onDocumentClick:function(t){t.closest(".joms-postbox").length||this.hide()}})}),define("views/dropdown/mood",["sandbox","views/dropdown/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/dropdown/mood"],events:{"click li":"onSelect","click .joms-remove-button":"onRemove"},moods:["happy","meh","sad","loved","excited","pretty","tired","angry","speachless","shocked","irretated","sick","annoyed","relieved","blessed","bored"],render:function(){var e=this.template({items:this.moods,language:{status:i.get("status")||{},moodshort:i.get("moodshort")||{}}}),s=t(e).hide();return this.$el.replaceWith(s),this.setElement(s),this.$btnremove=this.$(".joms-remove-button").hide(),this},select:function(t){this.moods.indexOf(t)>=0&&(this.$btnremove.show(),this.trigger("select",this.mood=t))},value:function(){return this.mood},reset:function(){this.mood=!1,this.$btnremove.hide(),this.trigger("reset")},onSelect:function(e){var i=t(e.currentTarget),s=i.attr("data-mood");this.select(s),this.hide()},onRemove:function(){this.mood=!1,this.$btnremove.hide(),this.trigger("remove")}})}),define("views/dropdown/location",["sandbox","views/dropdown/base","utils/language"],function(t,e,i){var s=i.get("geolocation")||{};return e.extend({template:{div:joms.jst["html/dropdown/location"],list:joms.jst["html/dropdown/location-list"]},placeholders:{loading:s.loading||"",loaded:s.loaded||"",error:s.error||""},initialize:function(){e.prototype.initialize.apply(this),this.locations=[],this.location=!1,this.listenTo(t,"postbox:tab:change",this.onRemove)},events:{"keyup input.joms-postbox-keyword":"onKeyup","click li":"onSelect","click button.joms-add-location":"onAdd","click button.joms-remove-location":"onRemove"},render:function(){return this.$el.html(this.getTemplate()),this.$keyword=this.$(".joms-postbox-keyword"),this.$list=this.$(".joms-postbox-locations"),this.$map=this.$(".joms-postbox-map"),this.$btnadd=this.$(".joms-add-location").hide(),this.$btnremove=this.$(".joms-remove-location").hide(),this.$keyword.attr("placeholder",this.placeholders.loading),this.detectLocation(),this},show:function(){this.$el.show(),this.trigger("show")},hide:function(){this.$el.hide(),this.trigger("hide")},toggle:function(){var t="none"===this.el.style.display;t?this.show():this.hide()},filter:function(){var t=this.$keyword.val().replace(/^\s+|\s+$/,""),e=this.locations;if(t.length){t=new RegExp(t,"i"),e=[];for(var i,s=0;s<this.locations.length;s++)i=this.locations[s],i=[i.name,i.vicinity].join(" "),i.match(t)&&e.push(this.locations[s])}this.draw(e)},draw:function(e){var s=this.template.list({language:{geolocation:i.get("geolocation")},items:e});this.filtered=e,t.mobile?this.$list.html(s).css({height:"160px",overflowY:"auto"}):this.$list.html(s).slimScroll({height:"150px",alwaysVisible:!0})},select:function(t){var e=this.filtered[t];e&&(this.location=e,this.$map.show(),this.$keyword.val(e.name),this.map&&this.marker&&this.marker.setMap(this.map),this.showMap(e.latitude,e.longitude),this.$btnadd.show(),this.$btnremove.hide())},value:function(){var t=[];return this.location?(t.push(this.location.name),t.push(this.location.latitude),t.push(this.location.longitude),t):!1},reset:function(){this.location=!1,this.marker&&this.marker.setMap(null),this.$keyword.val(""),this.$btnadd.hide(),this.$btnremove.hide(),this.trigger("reset")},onKeyup:t.debounce(function(){this.filter()},100),onSelect:function(e){var i=t(e.currentTarget),s=i.attr("data-index");this.select(+s)},onAdd:function(){this.location&&(this.trigger("select",this.location),this.$btnadd.hide(),this.$btnremove.show(),this.hide())},onRemove:function(){this.reset(),this.trigger("remove"),this.hide(),this.filter()},initMap:function(e){var i=t("<div>").prependTo(this.$map);i.css("height",110);var s={center:e,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAD,mapTypeControl:!1,disableDefaultUI:!0,draggable:!1,scaleControl:!1,scrollwheel:!1,navigationControl:!1,streetViewControl:!1,disableDoubleClickZoom:!0};this.map=new google.maps.Map(i[0],s),this.marker=new google.maps.Marker({draggable:!1,map:this.map}),this.marker.setAnimation(null)},showMap:function(e,i){var s=t.isUndefined(i)?e:new google.maps.LatLng(e,i);this.map||this.initMap(s),this.marker.setPosition(s),this.map.panTo(s)},detectLocation:function(){navigator.geolocation.getCurrentPosition(t.bind(this.detectLocationSuccess,this),t.bind(this.detectLocationFallback,this),{timeout:1e4})},detectLocationSuccess:function(t){var e=t&&t.coords||{},i=e.latitude,s=e.longitude;return i&&s?(this.detectLocationNearby(i,s),void 0):(this.detectLocationFailed(),void 0)},detectLocationFallback:function(){var e=!1,i=this;t.ajax({url:"//freegeoip.net/json/",dataType:"jsonp",success:function(t){var s=t.latitude,o=t.longitude;s&&o&&(e=!0,i.detectLocationNearby(s,o))},complete:function(){e||i.detectLocationFailed()}})},detectLocationFailed:function(){this.$keyword.attr("placeholder",this.placeholders.error)},detectLocationNearby:function(e,i){var s=t.isUndefined(i)?e:new google.maps.LatLng(e,i);this.initMap(s);var o=new google.maps.places.PlacesService(this.map),n={location:new google.maps.LatLng(e,i),radius:100};this.locations=[];var a=this;o.nearbySearch(n,function(e,i){if(i!==google.maps.places.PlacesServiceStatus.OK)return a.detectLocationFailed(),void 0;if(!t.isArray(e))return a.detectLocationFailed(),void 0;for(var s,o=0;o<e.length;o++)s=e[o],a.locations.push({name:s.name,latitude:s.geometry.location.lat(),longitude:s.geometry.location.lng(),vicinity:s.vicinity});a.$keyword.attr("placeholder",a.placeholders.loaded),a.filter()})},getTemplate:function(){var t=this.template.div({language:{geolocation:i.get("geolocation")||{}}});return t}})}),define("views/dropdown/privacy",["sandbox","views/dropdown/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/dropdown/privacy"],events:{"click li":"select"},privacies:{"public":[10,"globe"],site_members:[20,"users"],friends:[30,"user"],me:[40,"lock"]},privmaps:{"public":"10",site_members:"20",friends:"30",me:"40",0:"public",10:"public",20:"site_members",30:"friends",40:"me"},initialize:function(s){e.prototype.initialize.apply(this),this.privkeys=t.keys(this.privacies),s&&s.privacylist&&s.privacylist.length&&(this.privkeys=t.intersection(this.privkeys,s.privacylist));var o=i.get("privacy")||{};for(var n in this.privacies)this.privacies[n][2]=o[n]||n,this.privacies[n][3]=o[n+"_desc"]||n;this.defaultPrivacy=this.privkeys[0],"undefined"!=typeof s.defaultPrivacy&&(s.defaultPrivacy=""+s.defaultPrivacy,s.defaultPrivacy.match(/^\d+$/)&&(s.defaultPrivacy=this.privmaps[s.defaultPrivacy]||this.defaultPrivacy),this.defaultPrivacy=s.defaultPrivacy)},render:function(){for(var t,e=[],i=0;i<this.privkeys.length;i++)t=this.privkeys[i],e[i]=[t,this.privacies[t][1],this.privacies[t][2],this.privacies[t][3]];return this.$el.html(this.template({items:e})),this.setPrivacy(this.defaultPrivacy),this},select:function(e){var i=t(e.currentTarget),s=i.attr("data-priv");this.setPrivacy(s),this.hide()},setPrivacy:function(t){var e={};this.privkeys.indexOf(t)>=0&&(this.privacy=this.privacies[t][0],e.icon=this.privacies[t][1],e.label=this.privacies[t][2].toLowerCase(),this.trigger("select",e))},value:function(){return this.privacy},reset:function(){this.setPrivacy(this.defaultPrivacy)}})}),define("views/postbox/status",["sandbox","app","views/postbox/default","views/postbox/fetcher","views/inputbox/status","views/dropdown/mood","views/dropdown/location","views/dropdown/privacy","utils/constants","utils/language"],function(t,e,i,s,o,n,a,h,r,l){return i.extend({subviews:{mood:n,location:a,privacy:h},template:joms.jst["html/postbox/status"],events:t.extend({},i.prototype.events,{"click li[data-tab=photo]":"onAddPhoto","click li[data-tab=video]":"onAddVideo"}),initialize:function(){var e=r.get("settings")||{};(this.inheritPrivacy=e.isGroup||e.isEvent||!e.isMyProfile)&&(this.subviews=t.omit(this.subviews,"privacy")),this.enableMood=+r.get("conf.enablemood"),this.enableMood||(this.subviews=t.omit(this.subviews,"mood")),this.enableLocation=+r.get("conf.enablelocation"),this.enableLocation||(this.subviews=t.omit(this.subviews,"location")),i.prototype.initialize.apply(this)},render:function(){i.prototype.render.apply(this),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$fetcher=this.$(".joms-postbox-fetched"),this.$tabmood=this.$tabs.find("[data-tab=mood]"),this.$tablocation=this.$tabs.find("[data-tab=location]"),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.enableMood||this.$tabmood.remove(),this.enableLocation||this.$tablocation.remove(),this.inheritPrivacy&&(this.$tabprivacy.next().length?this.$tabprivacy.remove():this.$tabprivacy.css({visibility:"hidden"})),this.inputbox=new o({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.listenTo(this.inputbox,"keydown",this.onInputUpdate);var e,s;return this.inheritPrivacy||(s=r.get("settings")||{},s.isProfile&&s.isMyProfile&&(e=r.get("conf.profiledefaultprivacy")),this.initSubview("privacy",{defaultPrivacy:e||"public"})),this.single&&this.listenTo(t,"click",this.onDocumentClick),this},reset:function(){i.prototype.reset.apply(this),this.inputbox&&this.inputbox.reset(),this.fetcher&&this.fetcher.remove()},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={},this.data.text=this.data.text.replace(/\n/g,"\\n");var t;for(var e in this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.fetcher&&(this.data.attachment.fetch=this.fetcher.value()),i.prototype.value.apply(this,arguments)},validate:t.noop,onInputFocus:function(){this.showMainState()},onInputUpdate:function(e,i){var o;if(e=e||"",this.togglePostButton(e),32===i||13===i){if(this.fetcher&&this.fetcher.fetched)return;this.fetcher&&this.fetcher.remove(),o=t("<div>").appendTo(this.$fetcher),this.fetcher=new s,this.fetcher.setElement(o),this.listenTo(this.fetcher,"fetch:start",this.onFetchStart),this.listenTo(this.fetcher,"fetch:done",this.onFetchDone),this.listenTo(this.fetcher,"remove",this.onFetchRemove),this.fetcher.fetch(e.replace(/^\s+|\s+$/g,""))}},onFetchStart:function(){this.saving=!0,this.$loading.show()},onFetchDone:function(){this.$loading.hide(),this.saving=!1},onFetchRemove:function(){this.fetcher=!1},onDocumentClick:function(t){if(!t.closest(".joms-postbox").length){var e=this.inputbox.value();e=e.replace(/^\s+|\s+$/g,""),e||this.showInitialState()}},onMoodSelect:function(t){this.inputbox.updateAttachment(t),this.togglePostButton()},onMoodRemove:function(){this.inputbox.updateAttachment(!1),this.togglePostButton()},onLocationSelect:function(t){this.inputbox.updateAttachment(null,t),this.togglePostButton()},onLocationRemove:function(){this.inputbox.updateAttachment(null,!1),this.togglePostButton()},onPrivacySelect:function(t){this.$tabprivacy.find("i").attr("class","joms-icon-"+t.icon),this.$tabprivacy.find("span").html(t.label)},onAddPhoto:function(){e.postbox||(e.postbox={}),e.postbox.value=this.value(!0),t.trigger("postbox:photo")},onAddVideo:function(){e.postbox||(e.postbox={}),e.postbox.value=this.value(!0),t.trigger("postbox:video")},getTemplate:function(){var e=r.get("settings")||{},i=r.get("conf")||{},s=!0,o=!0;e.isEvent?s=o=!1:(e.isProfile||e.isGroup)&&(i.enablephotos||(s=!1),i.enablevideos||(o=!1));var n=this.template({juri:r.get("juri"),enablephoto:s,enablevideo:o,language:{postbox:l.get("postbox")||{},status:l.get("status")||{}}});return t(n).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},r.get("postbox.attachment")||{},{type:"message"}),this.staticAttachment)},togglePostButton:function(t){var e=!1;t&&(e=!0),!e&&this.subflags.mood&&(e=this.subviews.mood.value()),!e&&this.subflags.location&&(e=this.subviews.location.value()),this.$save[e?"show":"hide"]()}})}),define("views/widget/select",["sandbox","views/base"],function(t,e){return e.extend({template:joms.jst["html/widget/select"],events:{"click span":"toggle","click li":"onSelect"},initialize:function(t){this.options=t.options||[],+t.width&&(this.width=+t.width+"px")},render:function(){var t={};t.options=this.options,t.width=this.width||!1,this.$el.html(this.template(t)),this.$span=this.$("span"),this.$ul=this.$("ul"),t.options&&(t.options.length>6&&(this.$ul.slimScroll({height:"165px",alwaysVisible:!0}),this.$ul=this.$ul.closest(".slimScrollDiv").hide(),this.$ul.css({position:"absolute",width:"100%"}),this.$ul.find("ul").css({display:"",width:""})),t.options[0]&&this.select(t.options[0][0],t.options[0][1]))},select:function(t,e){this.$span.html(e),this.$span.data("value",t),this.trigger("select",t,e)},toggle:function(){this.$ul.toggle()},value:function(){return this.$span.data("value")},reset:function(){this.$ul&&this.$ul.hide(),this.options&&this.options.length&&(this.$span.html(this.options[0][1]),this.$span.data("value",this.options[0][0]))},onSelect:function(e){var i=t(e.currentTarget),s=i.data("value"),o=i.html();this.select(s,o),this.toggle()}})}),define("views/widget/select-album",["sandbox","views/widget/select"],function(t,e){return e.extend({template:joms.jst["html/widget/select-album"],render:function(){var t={};t.options=this.options,t.width=this.width||!1,this.$el.html(this.template(t)),this.$span=this.$("span"),this.$ul=this.$("ul"),t.options&&(t.options.length>3&&(this.$ul.slimScroll({height:"150px",alwaysVisible:!0}),this.$ul=this.$ul.closest(".slimScrollDiv").hide(),this.$ul.css({position:"absolute",width:"100%"}),this.$ul.find("ul").css({display:"",width:""})),t.options[0]&&this.select(t.options[0][0],t.options[0][1]))},onSelect:function(e){var i=t(e.currentTarget),s=i.data("value"),o=i.find("p").html();this.select(s,o),this.toggle()}})}),define("views/postbox/photo-preview",["sandbox","app","views/base","views/widget/select-album","utils/ajax","utils/constants","utils/language"],function(t,e,i,s,o,n,a){return i.extend({templates:{div:joms.jst["html/postbox/photo-preview"],img:joms.jst["html/postbox/photo-item"]},events:{"click .joms-postbox-photo-remove":"onRemove"},render:function(){this.$el.html(this.templates.div()),this.$list=this.$("ul"),this.$form=this.$("div.joms-postbox-photo-form")},add:function(i){if(this.$list.append(this.templates.img({id:this.getFileId(i),src:e.legacyUrl+"/assets/photo-upload-placeholder.png"})),!this.select){var o=n.get("album"),h=a.get("privacy"),r=[],l={0:"public",10:"public",20:"site_members",30:"friends",40:"me"},d={0:"globe",10:"public",20:"users",30:"user",40:"lock"};if(o&&o.length){this.albummap={};for(var c,u,p=0;p<o.length;p++)c=o[p],u=""+c.permissions,this.albummap[""+c.id]=u,c=[c.id,c.name,h[l[u]||"0"],d[u||"0"]],r[+c["default"]?"unshift":"push"](c);this.select=new s({options:r});var m=t('<div class="joms-postbox-select-album joms-select">').insertAfter(this.$form);this.assign(m,this.select)}}},value:function(){var t,e;return this.select&&(t=""+this.select.value(),e=this.albummap[t]),{id:this.pics||[],album_id:t,privacy:e}},updateProgress:function(t){var e,i=this.getFileId(t),s=this.$list.find("#"+i).find(".joms-postbox-photo-progress");s&&s.length&&(e=Math.min(100,Math.floor(t.loaded/t.size*100)),s.stop().animate({width:e+"%"}))},setImage:function(t,e){e||(e={});var i=this.$list.find("#"+this.getFileId(t)),s=n.get("juri.base")+e.thumbnail,o=e.id;i.find("img").attr("src",s).data("id",o),i.find("img").attr("style","visibility:visible"),i.find(".joms-postbox-photo-action").show(),i.addClass("joms-postbox-photo-loaded"),i.find(".joms-postbox-photo-progressbar").remove(),this.pics||(this.pics=[]),this.pics.push(""+o),this.trigger("update",this.pics.length)},removeFailed:function(){this.$list.find(".joms-postbox-photo-item").not(".joms-postbox-photo-loaded").remove(),this.trigger("update",this.pics&&this.pics.length||0)},onRemove:function(e){var i,s=t(e.target).closest("li"),o=s.find("img").data("id");s.remove(),this.pics=t.without(this.pics,""+o),i=this.pics.length,0>=i&&this.select.remove(),this.ajaxRemove([o]),this.trigger("update",i)},remove:function(){return this.pics&&this.pics.length&&this.ajaxRemove(this.pics),i.prototype.remove.apply(this,arguments)},ajaxRemove:function(e){var i={};i.option="community",i.no_html=1,i.task="azrul_ajax",i.func="system,ajaxDeleteTempImage",i[window.jax_token_var]=1,e&&e.length&&(i["arg2[]"]=e),t.ajax({url:window.jax_live_site,type:"post",dataType:"json",data:i})},getFileId:function(t){return"postbox-preview-"+t.id}})}),define("views/inputbox/photo",["sandbox","views/inputbox/status","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/photo"],initialize:function(){e.prototype.initialize.apply(this,arguments),this.hint={single:i.get("status.photo_hint")||"",multiple:i.get("status.photos_hint")||""}},reset:function(){e.prototype.reset.apply(this,arguments),this.single()},single:function(){this.$textarea.attr("placeholder",this.hint.single)},multiple:function(){this.$textarea.attr("placeholder",this.hint.multiple)},getTemplate:function(){var e=this.template({placeholder:this.hint.single});return t(e)}})}),define("utils/uploader",["sandbox","app"],function(t,e){function i(t){if(this.queue=[],this.ready=!1,window.plupload)return this.ready=!0,this.create(t),void 0;
var i=this;$LAB.script(e.legacyUrl+"multiupload_js/plupload.js").wait(function(){i.ready=!0,i.create(t),i.execQueue()})}var s={runtimes:"html5,html4",url:"index.php"};return i.prototype.create=function(e){var i=this.$button=e.browse_button,o=!1;"string"==typeof i?this.$button=t(document.getElementById(i)):(o=i.attr("id"))?this.$button=t(document.getElementById(o)):(e.browse_button=o=t.uniqueId("uploader_"),i.attr("id",o)),this.onProgress=e.onProgress||t.noop,this.onAdded=e.onAdded||t.noop,e=t.extend({},s,e||{}),this.uploader=new plupload.Uploader(e)},i.prototype.init=function(){return this.ready?(this.uploader.init(),this.uploader.bind("FilesAdded",this.onAdded),this.uploader.bind("Error",this.onError),this.uploader.bind("BeforeUpload",this.onBeforeUpload),this.uploader.bind("UploadProgress",this.onProgress),this.uploader.bind("FileUploaded",this.onUploaded),this.uploader.bind("UploadComplete",this.onComplete),void 0):(this.queue.push(["init",this,arguments]),void 0)},i.prototype.open=function(){return this.ready?(this.$button.click(),void 0):(this.queue.push(["open",this,arguments]),void 0)},i.prototype.reset=function(){return this.ready?void 0:(this.queue.push(["reset",this,arguments]),void 0)},i.prototype.remove=function(){return this.ready?void 0:(this.queue.push(["remove",this,arguments]),void 0)},i.prototype.params=function(t){this.uploader.settings.multipart_params=t},i.prototype.upload=function(){return this.ready?void 0:(this.queue.push(["upload",this,arguments]),void 0)},i.prototype.execQueue=function(){for(var t;this.queue.length;)t=this.queue.shift(),this[t[0]].apply(t[1],t[2])},i.prototype.onAdded=t.noop,i.prototype.onError=t.noop,i.prototype.onBeforeUpload=t.noop,i.prototype.onProgress=t.noop,i.prototype.onUploaded=t.noop,i.prototype.onComplete=t.noop,i}),define("views/postbox/photo",["sandbox","app","views/postbox/default","views/postbox/photo-preview","views/inputbox/photo","views/widget/select","utils/constants","utils/language","utils/uploader"],function(t,e,i,s,o,n,a,h,r){return i.extend({template:joms.jst["html/postbox/photo"],events:t.extend({},i.prototype.events,{"click .joms-postbox-photo-upload":"onPhotoAdd","click li[data-tab=upload]":"onPhotoAdd"}),render:function(){i.prototype.render.apply(this),this.$initial=this.$(".joms-postbox-inner-panel"),this.$main=this.$(".joms-postbox-photo"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$preview=this.$(".joms-postbox-preview"),this.$tabupload=this.$("[data-tab=upload]"),this.$uploader=this.$("#joms-postbox-photo-upload"),this.$uploaderParent=this.$uploader.parent(),this.inputbox=new o({charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus);var e="index.php?option=com_community&view=photos&task=ajaxPreview",s=a.get("settings")||{};s.isGroup&&(e+="&no_html=1&tmpl=component&groupid="+(a.get("groupid")||"")),t.ie&&(this.$uploader.appendTo(document.body),this.$uploader.show());var n={container:"joms-postbox-photo-upload",browse_button:"joms-postbox-photo-upload-btn",url:e,filters:[{title:"Image files",extensions:"jpg,jpeg,png,gif"}]};return t.mobile||(n.resize={width:2100,height:2100,quality:90}),this.uploader=new r(n),this.uploader.onAdded=t.bind(this.onPhotoAdded,this),this.uploader.onError=t.bind(this.onPhotoError,this),this.uploader.onProgress=t.bind(this.onPhotoProgress,this),this.uploader.onUploaded=t.bind(this.onPhotoUploaded,this),this.uploader.init(),t.ie&&(this.$uploader.hide(),this.$uploader.appendTo(this.$uploaderParent)),this},showInitialState:function(){this.$main.hide(),this.$initial.show(),t.ie&&t.ieVersion<10&&this.ieUploadButtonFix(!0),this.inputbox&&this.inputbox.single(),this.preview&&this.preview.remove(),this.preview=!1,i.prototype.showInitialState.apply(this)},showMainState:function(){i.prototype.showMainState.apply(this),this.$action.hide(),this.$initial.hide(),this.$main.show(),this.$save.show(),t.ie&&t.ieVersion<10&&this.ieUploadButtonFix(),e.postbox&&e.postbox.value&&e.postbox.value.length&&this.inputbox.set(e.postbox.value[0])},reset:function(){i.prototype.reset.apply(this),this.inputbox&&this.inputbox.reset(),this.preview&&this.preview.remove(),this.preview=!1},value:function(){return this.data.text=this.inputbox.value()||"",this.data.attachment={},this.preview&&t.extend(this.data.attachment,this.preview.value()),i.prototype.value.apply(this,arguments)},validate:function(){var t=this.value(!0),e=t[1]||{};return!e.id&&e.id.length?"No image selected.":void 0},onPhotoAdd:function(){if(!this.uploading){var e=a.get("conf")||{},i=+e.limitphoto,s=+e.uploadedphoto;return this.preview&&this.preview.pics&&this.preview.pics.length>=8?(window.alert("You have reached maximum 8 images for 1 batch upload."),void 0):(this.preview&&this.preview.pics&&this.preview.pics.length&&(s+=this.preview.pics.length),s>=i?(window.alert(h.get("photo.upload_limit_exceeded")||"You have reached the upload limit."),void 0):(t.ie&&10===t.ieVersion?this.$("#joms-postbox-photo-upload").find("input[type=file]").click():this.uploader.open(),void 0))}},onPhotoAdded:function(e,i){if(!this.uploading&&i&&i.length){var o=0;this.preview&&this.preview.pics&&this.preview.pics.length&&(o=this.preview.pics.length),o+i.length>8&&(o=o+i.length-8,i.splice(0-o,o),e.splice(0-o,o));var n=a.get("conf")||{},h=+n.limitphoto,r=+n.uploadedphoto;this.preview&&this.preview.pics&&this.preview.pics.length&&(r+=this.preview.pics.length);var l;r+i.length>h&&(l=r+i.length-h,i.splice(0-l,l),e.splice(0-l,l));var d;this.preview||(d=t("<div>").appendTo(this.$preview),this.preview=new s,this.assign(d,this.preview),this.listenTo(this.preview,"update",function(t){return!t||0>=t?(this.showInitialState(),this.inputbox.single(),this.uploading=0,void 0):(this.inputbox[t>1?"multiple":"single"](),void 0)})),this.showMainState();for(var c=0;c<i.length;c++)this.preview.add(i[c]);this.uploading=i.length,this.$action.hide(),e.start(),e.refresh()}},onPhotoError:function(t,e){+e.code===+plupload.FILE_EXTENSION_ERROR&&window.alert("Selected file type is not permitted.")},onPhotoProgress:function(t,e){this.preview.updateProgress(e)},onPhotoUploaded:function(t,e,i){var s;try{s=JSON.parse(i.response)}catch(o){}return s||(s={}),s.thumbnail?(this.uploading--,this.uploading<=0&&this.$action.show(),this.preview&&this.preview.setImage(e,s),void 0):(t.stop(),t.splice(),window.alert(s&&s.msg||"Undefined error."),this.uploading=0,this.$action.show(),this.preview&&this.preview.removeFailed(),void 0)},getTemplate:function(){var e=this.template({juri:a.get("juri"),language:{postbox:h.get("postbox")||{},photo:h.get("photo")||{}}});return t(e).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},a.get("postbox.attachment")||{},{type:"photo"}),this.staticAttachment)},ieUploadButtonFix:function(t){this.ieUploadButtonFix.init||(this.ieUploadButtonFix.init=!0,this.$uploader.css({display:"block",position:"absolute",opacity:0,width:"",height:""}).children("button,form").css({display:"block",position:"absolute",width:"",height:"",top:0,right:0,bottom:0,left:0}).children("input").css({cursor:"pointer",height:"100%"})),t?(this.$uploader.appendTo(this.$uploaderParent),this.$uploader.css({top:12,right:12,bottom:12,left:12}).children("form").css({width:"100%",height:"100%"})):(this.$uploader.appendTo(this.$tabupload),this.$uploader.css({top:0,right:0,bottom:0,left:0}))}})}),define("views/inputbox/videourl",["sandbox","views/inputbox/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/videourl"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},onKeydown:function(e){e&&13===e.keyCode&&e.preventDefault();var i=this;t.defer(function(){i.updateInput(e)})},getTemplate:function(){var e=i.get("video.link_hint")||"",s=this.template({placeholder:e});return t(s)}})}),define("views/postbox/fetcher-video",["sandbox","views/base","views/widget/select","utils/ajax","utils/language"],function(t,e,i,s,o){return e.extend({template:joms.jst["html/postbox/fetcher-video"],events:{"click .joms-fetched-close":"onClose","click .joms-fetched-field span":"onFocus","keyup .joms-fetched-field input":"onKeyup","keyup .joms-fetched-field textarea":"onKeyup","blur .joms-fetched-field input":"onBlur","blur .joms-fetched-field textarea":"onBlur"},initialize:function(){var t=o.get("fetch")||{};this.titlePlaceholder=t.title_hint||"",this.descPlaceholder=t.description_hint||"",t=o.get("video"),this.categoryLabel=t.category_label},fetch:function(e){var i=/^(|.*\s)(https?:\/\/|www\.)([a-z0-9-]+\.)+[a-z]{2,4}(:\d+)?(\/.*)?(\s.*|)$/i,o=e.match(i);if(!this.fetching&&o){this.id=!1,this.url=e,this.fetching=!0,this.fetched=!1,this.trigger("fetch:start");var n=this;s({fn:"videos,ajaxLinkVideoPreview",data:[e],complete:function(){n.fetching=!1,n.trigger("fetch:done")},success:t.bind(this.render,this)})}},render:function(t){if(t=this.parseResponse(t),!t)return this.trigger("fetch:failed"),void 0;var e=t&&t.video,s=t&&t.category||[];if(!e||!e.id)return this.trigger("fetch:failed",t),void 0;this.video_id=e.id,this.fetched=!0;var o={title:e.title||"",titlePlaceholder:this.titlePlaceholder,description:e.description||"",descPlaceholder:this.descPlaceholder,image:e.thumb||!1};this.select&&this.select.remove(),this.$el.html(this.template(o)),this.$image=this.$(".joms-fetched-images").find("img"),this.$title=this.$(".joms-fetched-title").find("input"),this.$description=this.$(".joms-fetched-description").find("textarea"),this.$category=this.$(".joms-fetched-category");for(var n=[],a=0;a<s.length;a++)n.push([s[a].id,this.categoryLabel+": "+s[a].name]);return this.select=new i({options:n}),this.assign(this.$category,this.select),this},change:function(e){var i=t(e),s=i.prev("span"),o=i.val().replace(/^\s+|\s+$/g,"");o||(o=i.parent().hasClass("joms-fetched-title")?this.titlePlaceholder:this.descPlaceholder),i.hide(),s.text(o).show()},remove:function(){e.prototype.remove.apply(this),this.trigger("remove")},value:function(){return this.fetching?[]:[this.video_id,this.url,this.$image&&this.$image.attr("src"),this.$title&&this.$title.val().replace(/\t/g,"\\t").replace(/\n/g,"\\n"),this.$description&&this.$description.val().replace(/\t/g,"\\t").replace(/\n/g,"\\n"),this.select&&this.select.value()]},onClose:function(){this.remove()},onFocus:function(e){var i=t(e.currentTarget),s=i.next("input,textarea");i.hide(),s.show(),setTimeout(function(){s[0].focus()},300)},onKeyup:function(t){13===t.keyCode&&this.change(t.currentTarget)},onBlur:function(t){this.change(t.currentTarget)},parseResponse:function(t){var e;if(t&&t.length)for(var i=0;i<t.length;i++){if("__throwError"===t[i][1]){e={msg:t[i][3]};break}if("__callback"===t[i][1]){e=t[i][3][0];break}}return e}})}),define("views/inputbox/video",["sandbox","views/inputbox/status","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/video"],getTemplate:function(){var e=i.get("status.video_hint")||"",s=this.template({placeholder:e});return t(s)}})}),define("views/postbox/video",["sandbox","app","views/postbox/default","views/inputbox/videourl","views/postbox/fetcher-video","views/inputbox/video","views/dropdown/location","views/dropdown/privacy","views/widget/select","utils/ajax","utils/constants","utils/language","utils/uploader"],function(t,e,i,s,o,n,a,h,r,l,d,c,u){return i.extend({subviews:{location:a,privacy:h},template:joms.jst["html/postbox/video"],events:t.extend({},i.prototype.events,{"click [data-action=share]":"onVideoUrl","click [data-action=upload]":"onVideoUpload"}),initialize:function(){this.enableUpload=+d.get("conf.enablevideosupload"),this.enableLocation=+d.get("conf.enablevideosmap");var e=d.get("settings")||{};(this.inheritPrivacy=e.isGroup||e.isEvent||!e.isMyProfile)&&(this.subviews=t.omit(this.subviews,"privacy")),this.language={postbox:c.get("postbox"),status:c.get("status"),video:c.get("video")},i.prototype.initialize.apply(this)},render:function(){i.prototype.render.apply(this),this.$initial=this.$(".joms-initial-panel"),this.$main=this.$(".joms-postbox-video"),this.$stateurl=this.$(".joms-postbox-video-state-url"),this.$stateupload=this.$(".joms-postbox-video-state-upload"),this.$url=this.$stateurl.find(".joms-postbox-url"),this.$fetcher=this.$stateurl.find(".joms-postbox-fetched"),this.$file=this.$stateupload.find(".joms-postbox-url"),this.$fileprogress=this.$stateupload.find(".joms-postbox-photo-progress"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$tabupload=this.$tabs.find("[data-tab=upload]"),this.$tablocation=this.$tabs.find("[data-tab=location]"),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.inheritPrivacy&&this.$tabprivacy.css({visibility:"hidden"}),this.url=new s,this.assign(this.$url,this.url),this.listenTo(this.url,"focus",this.onUrlFocus),this.listenTo(this.url,"keydown",this.onUrlUpdate),this.listenTo(this.url,"blur",this.onUrlUpdate),this.inputbox=new n({attachment:!0,charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus);var e,o;this.inheritPrivacy||(o=d.get("settings")||{},o.isProfile&&o.isMyProfile&&(e=d.get("conf.profiledefaultprivacy")),this.initSubview("privacy",{defaultPrivacy:e||"public"}));var a=+d.get("conf.maxvideouploadsize")||0;return a&&(a+="mb"),this.uploader=new u({container:"joms-postbox-video-upload",browse_button:"joms-postbox-video-upload-btn",url:"index.php?option=com_community&view=videos&task=uploadvideo",multi_selection:!1,filters:[{title:"Video files",extensions:"3g2,3gp,asf,asx,avi,flv,mov,mp4,mpg,rm,swf,vob,wmv,m4v"}],max_file_size:a}),this.uploader.onAdded=t.bind(this.onVideoAdded,this),this.uploader.onError=t.bind(this.onVideoError,this),this.uploader.onBeforeUpload=t.bind(this.onVideoBeforeUpload,this),this.uploader.onProgress=t.bind(this.onVideoProgress,this),this.uploader.onUploaded=t.bind(this.onVideoUploaded,this),this.uploader.init(),this},showInitialState:function(){this.reset(),this.$tabs.hide(),this.$action.hide(),this.$save.hide(),this.enableUpload?(this.$main.hide(),this.$initial.show()):this.showUrlState(),this.trigger("show:initial")},showMainState:function(t){t?this.showUploadState():this.showUrlState(),this.$tabs.show(),this.$action.show(),this.trigger("show:main")},showUrlState:function(){this.inputbox.$el.find(".joms-postbox-input-placeholder").html(this.language.status.video_hint),this.$save.html(this.language.postbox.post_button),this.$stateupload.hide(),this.$stateurl.show(),this.$tablocation.hide(),this.$initial.hide(),this.$main.show(),this.$save.hide(),this.upload=!1,e.postbox&&e.postbox.value&&e.postbox.value.length&&this.inputbox.set(e.postbox.value[0])},showUploadState:function(){var t,i,s;if(!this.uploadcat){for(t=d.get("videoCategories")||[],i=[],s=0;s<t.length;s++)i.push([t[s].id,this.language.video.category_label+": "+t[s].name]);this.uploadcat=new r({options:i}),this.$uploadcat=this.$stateupload.find(".joms-fetched-category"),this.assign(this.$uploadcat,this.uploadcat)}this.inputbox.$el.find(".joms-postbox-input-placeholder").html(this.language.video.upload_hint),this.$save.html(this.language.postbox.upload_button),this.$stateurl.hide(),this.$stateupload.show(),this.$tablocation[this.enableLocation?"show":"hide"](),this.$initial.hide(),this.$main.show(),this.$save.show(),this.upload=!0,e.postbox&&e.postbox.value&&e.postbox.value.length&&this.inputbox.set(e.postbox.value[0])},reset:function(){i.prototype.reset.apply(this),this.url&&this.url.reset(),this.inputbox&&this.inputbox.reset(),this.fetcher&&this.fetcher.remove()},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={};var t;for(var e in this.subflags)(t=this.subviews[e].value())&&(this.data.attachment[e]=t);return this.upload?this.status&&"success"===this.status.status&&(this.data.attachment.fetch=[this.status.videoid]):this.fetcher&&(this.data.attachment.fetch=this.fetcher.value()),i.prototype.value.apply(this,arguments)},validate:function(){var t=this.value(!0),e=t[1]||{},i=e.fetch;if(this.upload);else if(!i||!i.length)return"Please share a valid video url."},onPost:function(){if(!this.saving){var e=this.validate();if(e)return window.alert(e),void 0;if(this.saving=!0,this.$loading.show(),this.upload===!0)return this.uploader.uploader.start(),void 0;var i=this;l({fn:"system,ajaxStreamAdd",data:this.value(),success:t.bind(this.onPostSuccess,this),complete:function(){i.$loading.hide(),i.saving=!1,i.showInitialState()}})}},onLocationSelect:function(t){this.inputbox.updateAttachment(null,t)},onLocationRemove:function(){this.inputbox.updateAttachment(null,!1)},onPrivacySelect:function(t){this.$tabprivacy.find("i").attr("class","joms-icon-"+t.icon),this.$tabprivacy.find("span").html(t.label)},onUrlFocus:function(){this.enableUpload||this.showMainState()},onUrlUpdate:function(e,i){var s;if(e&&(e=e.replace(/^\s+|\s+$/g,"")),32===i||13===i){if(this.fetcher&&this.fetcher.fetched)return;delete this.data.attachment.fetch,s=t("<div>").appendTo(this.$fetcher),this.fetcher&&this.fetcher.remove(),this.fetcher=new o,this.fetcher.setElement(s),this.listenTo(this.fetcher,"fetch:start",this.onFetchStart),this.listenTo(this.fetcher,"fetch:failed",this.onFetchFailed),this.listenTo(this.fetcher,"fetch:done",this.onFetchDone),this.listenTo(this.fetcher,"remove",this.onFetchRemove),this.fetcher.fetch(e)}},onInputFocus:function(){this.enableUpload||this.showMainState()},onFetchStart:function(){this.saving=!0,this.$loading.show(),this.$save.hide()},onFetchFailed:function(t){this.fetcher&&this.fetcher.remove(),this.saving=!1,this.$loading.hide(),this.$save.hide();var e=t&&t.msg||"Undefined error.";window.alert(e)},onFetchDone:function(){this.saving=!1,this.$loading.hide(),this.fetcher&&this.fetcher.fetched&&this.$save.show()},onFetchRemove:function(){this.fetcher=!1,this.$save.hide()},onVideoUrl:function(){this.showMainState()},onVideoUpload:function(){var t=d.get("conf")||{},e=+t.limitvideo,i=+t.uploadedvideo;return i>=e?(window.alert(c.get("video.upload_limit_exceeded")||"You have reached the upload limit."),void 0):(this.uploader.uploader.splice(),this.uploader.open(),void 0)},onVideoAdded:function(t,e){if(e&&e.length){for(var i=e[0],s="<b>"+i.name+"</b>",o=i.size||0,n="Bytes",a=["KB","MB","GB"];o>=1e3&&a.length;)n=a.shift(),o=Math.ceil(o/1e3);o&&(s+=" ("+o+" "+n+")"),this.$file.html(s),this.$fileprogress.css({width:0}),this.showMainState("upload")}},onVideoError:function(t,e){var i;+e.code===+plupload.FILE_SIZE_ERROR?(i=+d.get("conf.maxvideouploadsize")||0,window.alert("Maximum file size for video upload is "+i+" MB.")):+e.code===+plupload.FILE_EXTENSION_ERROR&&window.alert("Selected file type is not permitted.")},onVideoBeforeUpload:function(){var t={description:this.inputbox.value()};this.subflags.privacy&&(t.permissions=this.subviews.privacy.value());var e=this.subflags.location&&this.subviews.location.value();e&&e.length&&(t.location=e),this.uploadcat&&(t.category_id=this.uploadcat&&this.uploadcat.value()),this.uploader.params(t)},onVideoProgress:function(t,e){var i=Math.min(100,Math.round(100*e.loaded/e.size));this.$fileprogress.animate({width:i+"%"})},onVideoUploaded:function(t,e,i){var s,o;try{s=JSON.parse(i.response)}catch(n){}this.status=s||{},o=this,setTimeout(function(){if(o.$loading.hide(),o.saving=!1,o.showInitialState(),"success"!==o.status.status)window.alert(o.status.message||"Undefined error.");else{var t=d.get("conf")||{};++t.uploadedvideo,window.alert(o.status.processing_str)}},1e3)},getTemplate:function(){var e=this.template({juri:d.get("juri"),enable_upload:this.enableUpload,video_maxsize:d.get("conf.maxvideouploadsize"),language:{postbox:c.get("postbox")||{},video:c.get("video")||{}}});return t(e).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},d.get("postbox.attachment")||{},{type:"video"}),this.staticAttachment)}})}),define("views/inputbox/eventtitle",["sandbox","views/inputbox/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/eventtitle"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},getTemplate:function(){var e=i.get("event.title_hint")||"",s=this.template({placeholder:e});return t(s)}})}),define("views/inputbox/eventdesc",["sandbox","views/inputbox/base","utils/language"],function(t,e,i){return e.extend({template:joms.jst["html/inputbox/eventdesc"],render:function(){var t=this.getTemplate();this.$el.replaceWith(t),this.setElement(t),e.prototype.render.apply(this,arguments)},getTemplate:function(){var e=i.get("status.event_hint")||"",s=this.template({placeholder:e});return t(s)}})}),define("utils/format",["sandbox"],function(t){function e(e,i,s){if(!t.isString(e))return e;if(!t.isNumber(i)||e.length>=i)return e;i-=e.length;for(var o=0;i>o;o++)e=(s||" ")+e;return e}return{pad:e}}),define("views/dropdown/event",["sandbox","views/dropdown/base","views/widget/select","utils/constants","utils/language","utils/format"],function(t,e,i,s,o,n){return e.extend({template:joms.jst["html/dropdown/event"],events:{"click .joms-event-allday":"onToggleCheckbox","click .joms-postbox-done":"onSave"},initialize:function(){e.prototype.initialize.apply(this);var t=s.get("eventCategories")||[],o=[];if(this.categoriesMap={},t&&t.length)for(var n=0,a=t[n].id,h=t[n].name;n<t.length;n++)a=t[n].id,h=t[n].name,this.categoriesMap[a]=h,o.push([a,h]);this.category=new i({options:o})},render:function(){var e=this.getTemplate();return this.$el.replaceWith(e),this.setElement(e),this.$category=this.$(".joms-event-category"),this.$location=this.$("[name=location]").val(""),this.$startdate=this.$(".joms-pickadate-startdate").pickadate({min:new Date,klass:{frame:"picker__frame startDate"}}),this.$starttime=this.$(".joms-pickadate-starttime").pickatime({interval:10,klass:{frame:"picker__frame startTime"}}),this.$enddate=this.$(".joms-pickadate-enddate").pickadate({klass:{frame:"picker__frame endDate"}}),this.$endtime=this.$(".joms-pickadate-endtime").pickatime({interval:10,klass:{frame:"picker__frame endTime"}}),this.$done=this.$(".joms-event-done"),this.assign(this.$category,this.category),this.startdate=this.$startdate.pickadate("picker"),this.starttime=this.$starttime.pickatime("picker"),this.enddate=this.$enddate.pickadate("picker"),this.endtime=this.$endtime.pickatime("picker"),this.startdate.on({set:t.bind(this.onSetStartDate,this)}),this.starttime.on({set:t.bind(this.onSetStartTime,this)}),this.enddate.on({set:t.bind(this.onSetEndDate,this)}),this.endtime.on({set:t.bind(this.onSetEndTime,this)}),this},show:function(){return this.category&&this.category.reset(),e.prototype.show.apply(this,arguments)},toggleCheckbox:function(t){if(this.$allday&&this.$allday.length){var e=this.$allday.find("i");if(e&&e.length){var i=e.hasClass("joms-icon-check");i!==t&&(this.allday=t,e[this.allday?"removeClass":"addClass"]("joms-icon-check-empty"),e[this.allday?"addClass":"removeClass"]("joms-icon-check"),this.$starttime[this.allday?"hide":"show"](),this.$endtime[this.allday?"hide":"show"](),this.allday||this._checkTime())}}},value:function(){return this.data},validate:function(){},reset:function(){this.$location.val(""),this.$startdate.val(""),this.$starttime.val(""),this.$enddate.val(""),this.$endtime.val(""),this.toggleCheckbox(!1)},onToggleCheckbox:function(e){var i=t(e.currentTarget).find("i");this.toggleCheckbox(!i.hasClass("joms-icon-check"))},onSetStartDate:function(t){var e=t.select;this.enddate.set({min:new Date(e)},{muted:!0}),this.allday||this._checkTime()},onSetEndDate:function(t){var e=t.select;this.startdate.set({max:new Date(e)},{muted:!0}),this.allday||this._checkTime()},onSetStartTime:function(){this._checkTime("start")},onSetEndTime:function(){this._checkTime("end")},onSave:function(){var t,e=this.category.value(),i=this.startdate.get("select"),s=null,o=this.enddate.get("select"),n=null;return i&&(i=this._formatDate(i)),o&&(o=this._formatDate(o)),this.allday||(s=this.starttime.get("select"),s&&(s=this._formatTime(s)),n=this.endtime.get("select"),n&&(n=this._formatTime(n))),this.data={category:e?[e,this.categoriesMap[e]]:!1,location:this.$location.val(),startdate:i,enddate:o,allday:this.allday,starttime:s,endtime:n},this.data.category?this.data.location?this.data.startdate?this.data.allday||this.data.starttime?this.data.enddate?this.data.allday||this.data.endtime||(t="End time is not selected."):t="End date is not selected.":t="Start time is not selected.":t="Start date is not selected.":t="Location is not selected.":t="Category is not selected.",t?(window.alert(t),void 0):(this.trigger("select",this.data),this.hide(),void 0)},getTemplate:function(){var e=this.template({language:{event:o.get("event")||{}}});return t(e).hide()},_formatDate:function(t){return t?[t.year,n.pad(t.month+1+"",2,"0"),n.pad(t.date+"",2,"0")].join("-"):t},_formatTime:function(t){return t?[n.pad(t.hour+"",2,"0"),n.pad(t.mins+"",2,"0")].join(":"):t},_checkTime:function(){if(!this.allday){var t,e,i=this.startdate.get("select"),s=this.enddate.get("select");i&&s&&(s.year<=i.year&&s.month<=i.month&&s.date<=i.date?(t=this.starttime.get("select"),e=this.endtime.get("select"),t?(this.endtime.set({min:[t.hour,t.mins]},{muted:!0}),e&&e.time<t.time&&this.endtime.set({select:[t.hour,t.mins]},{muted:!0})):this.endtime.set({min:!1},{muted:!0}),e?(this.starttime.set({max:[e.hour,e.mins]},{muted:!0}),t&&t.time>e.time&&this.starttime.set({select:[e.hour,e.mins]},{muted:!0})):this.starttime.set({max:!1},{muted:!0})):(this.starttime.set({max:!1},{muted:!0}),this.endtime.set({min:!1},{muted:!0})))}}})}),define("views/postbox/event",["sandbox","views/postbox/default","views/inputbox/eventtitle","views/inputbox/eventdesc","views/dropdown/event","utils/constants","utils/format","utils/language"],function(t,e,i,s,o,n,a,h){return e.extend({subviews:{event:o},template:joms.jst["html/postbox/event"],events:t.extend({},e.prototype.events,{"click .joms-postbox-event-title":"onFocus"}),render:function(){return e.prototype.render.apply(this),this.$title=this.$(".joms-postbox-title"),this.$inputbox=this.$(".joms-postbox-inputbox"),this.$category=this.$(".joms-postbox-event-label-category"),this.$location=this.$(".joms-postbox-event-label-location"),this.$date=this.$(".joms-postbox-event-label-date"),this.title=new i,this.assign(this.$title,this.title),this.listenTo(this.title,"focus",this.onInputFocus),this.listenTo(this.title,"keydown",this.onNewInputUpdate),this.inputbox=new s({charcount:!0}),this.assign(this.$inputbox,this.inputbox),this.listenTo(this.inputbox,"focus",this.onInputFocus),this.listenTo(this.inputbox,"keydown",this.onNewInputUpdate),this},reset:function(){e.prototype.reset.apply(this),this.title&&this.title.reset(),this.inputbox&&this.inputbox.reset(),this.$category&&this.onEventSelect({})},value:function(){this.data.text=this.inputbox.value()||"",this.data.attachment={};var i;for(var s in this.subflags)(i=this.subviews[s].value())&&(this.data.attachment[s]=i);var o=null,n=null,a=this._data.allday?1:0;return a||(o=(this._data.starttime||"").split(":"),n=(this._data.endtime||"").split(":")),t.extend(this.data.attachment,{title:this.title.value(),catid:this._data.category&&this._data.category[0]||null,location:this._data.location,startdate:this._data.startdate,enddate:this._data.enddate,allday:a,"starttime-hour":a?null:o[0]||null,"starttime-min":a?null:o[1]||null,"endtime-hour":a?null:n[0]||null,"endtime-min":a?null:n[1]||null}),e.prototype.value.apply(this,arguments)},validate:function(){var t=this.value(!0),e=t[0];return e?void 0:"Event description cannot be empty."},onInputFocus:function(){this.showMainState()},onInputUpdate:t.debounce(function(){var t=this.value(!0),e=t[0],i=t[1],s=!0;this.trim(i.title)?this.trim(e)?i.catid?i.location?i.startdate?i.enddate?i.allday||i["starttime-hour"]||i["starttime-min"]?i.allday||i["endtime-hour"]||i["endtime-min"]||(s=!1):s=!1:s=!1:s=!1:s=!1:s=!1:s=!1:s=!1,this.$save[s?"show":"hide"]()},300),onNewInputUpdate:t.debounce(function(){var t=this.value(!0),e=t[0],i=t[1],s=!0;this.trim(i.title)?this.trim(e)?i.catid?i.location?i.startdate?i.enddate?i.allday||i["starttime-hour"]||i["starttime-min"]?i.allday||i["endtime-hour"]||i["endtime-min"]||(s=!1):s=!1:s=!1:s=!1:s=!1:s=!1:s=!1:s=!1,this.$save[s?"show":"hide"]()},300),onEventSelect:function(t){t.category?(this.$category.find(".joms-input-text").html(t.category&&t.category[1]),this.$category.show()):this.$category.hide(),t.location?(this.$location.find(".joms-input-text").html(t.location),this.$location.show()):this.$location.hide();var e,i=[];t.startdate&&t.enddate?(e=t.startdate.split("-"),e.reverse(),e=e.join("/"),t.allday||(e+=" "+t.starttime),i.push(e),e=t.enddate.split("-"),e.reverse(),e=e.join("/"),t.allday||(e+=" "+t.endtime),i.push(e),this.$date.find(".joms-input-text").html(i.join(" &mdash; ")),this.$date.show()):this.$date.hide(),this._data=t,this.onInputUpdate()},onPrivacySelect:function(t){this.$tabprivacy.find("i").attr("class","joms-icon-"+t.icon),this.$tabprivacy.find("span").html(t.label)},parseResponse:function(e){var i,s,o="activity-stream-container";if(e&&e.length)for(var n=0;n<e.length;n++)e[n][1]===o&&(i=e[n][3]),"al"===e[n][0]&&(s=e[n][3],window.alert(t.isArray(s)?s.join(". "):s)),"__throwError"===e[n][1]&&(s=e[n][3],window.alert(t.isArray(s)?s.join(". "):s));return i},getTemplate:function(){var e=h.get("event")||{};e.event_detail&&(e.event_detail=e.event_detail.toLowerCase());var i=this.template({juri:n.get("juri"),language:{postbox:h.get("postbox")||{},event:e}});return t(i).hide()},getStaticAttachment:function(){return this.staticAttachment?this.staticAttachment:(this.staticAttachment=t.extend({},n.get("postbox.attachment")||{},{type:"event"}),this.staticAttachment)},trim:function(t){return(t||"").replace(/^\s+|\s+$/g,"")}})}),define("views/postbox/custom",["sandbox","views/postbox/default","views/dropdown/privacy","utils/ajax","utils/constants","utils/language"],function(t,e,i,s,o,n){return e.extend({subviews:{privacy:i},template:joms.jst["html/postbox/custom"],events:t.extend({},e.prototype.events,{"click .joms-postbox-predefined-message":"onCustomPredefined","click .joms-postbox-custom-message":"onCustomCustom","keyup [name=custom]":"onTextareaUpdate"}),initialize:function(){var i=o.get("settings")||{};(this.inheritPrivacy=i.isGroup||i.isEvent||!i.isMyProfile)&&(this.subviews=t.omit(this.subviews,"privacy")),e.prototype.initialize.apply(this),this.attachment={type:"custom"},t.extend(this.attachment,o.get("postbox.attachment")||{})},render:function(){return e.prototype.render.apply(this),this.$initial=this.$el.children(".joms-postbox-inner-panel"),this.$main=this.$el.children(".joms-postbox-custom"),this.$statepredefined=this.$(".joms-postbox-custom-state-predefined"),this.$statecustom=this.$(".joms-postbox-custom-state-custom"),this.$predefined=this.$("[name=predefined]"),this.$custom=this.$("[name=custom]"),this.$divs=this.$(".joms-postbox-dropdown").hide(),this.$tabprivacy=this.$tabs.find("[data-tab=privacy]"),this.inheritPrivacy&&this.$tabprivacy.css({visibility:"hidden"}),this.inheritPrivacy||(this.initSubview("privacy",{privacylist:["public","site_members"]}),this.subviews.privacy.setPrivacy("public")),this},showInitialState:function(){this.$main.hide(),this.$initial.show(),e.prototype.showInitialState.apply(this)},showMainState:function(t){e.prototype.showMainState.apply(this),t?this.showPredefinedState():this.showCustomState()},showPredefinedState:function(){this.$initial.hide(),this.$statepredefined.show(),this.$statecustom.hide(),this.$main.show(),this.$save.show(),this.predefined=!0},showCustomState:function(){this.$initial.hide(),this.$statepredefined.hide(),this.$statecustom.show(),this.$main.show(),this.predefined=!1},reset:function(){e.prototype.reset.apply(this),this.$predefined&&this.$predefined.val(this.$predefined.find("option:first").val()),this.$custom&&this.$custom.val("")
},value:function(){var t=[];return this.predefined?(t.push(this.$predefined.val()),t.push(this.$predefined.find("option:selected").text())):(t.push("system.message"),t.push(this.$custom.val())),t},validate:function(){var t,e=this.value();return this.predefined?e[0]||(t="Predefined message cannot be empty."):e[1]||(t="Custom message cannot be empty."),t},onTextareaUpdate:function(){var t=this.$custom.val();t=t.replace(/^\s+|\s+$/g,""),this.$save[t?"show":"hide"]()},onCustomPredefined:function(){this.showMainState("predefined")},onCustomCustom:function(){this.showMainState()},onPost:function(){if(!this.saving){var e=this.validate();if(e)return window.alert(e),void 0;this.saving=!0,this.$loading.show();var i=this;s({fn:"activities,ajaxAddPredefined",data:this.value(),success:t.bind(this.onPostSuccess,this),complete:function(){i.$loading.hide(),i.saving=!1,i.showInitialState()}})}},onPrivacySelect:function(t){this.$tabprivacy.find("i").attr("class","joms-icon-"+t.icon),this.$tabprivacy.find("span").html(t.label)},getTemplate:function(){var e=o.get("customActivities")||{},i=[];for(var s in e)i.push([s,e[s]]);var a=this.template({juri:o.get("juri"),messages:i,language:{postbox:n.get("postbox"),custom:n.get("custom")}});return t(a).hide()}})}),define("views/postbox/layout",["sandbox","views/base","views/postbox/status","views/postbox/photo","views/postbox/video","views/postbox/event","views/postbox/custom","utils/constants"],function(t,e,i,s,o,n,a,h){return e.extend({subflags:{},subviews:{status:i,photo:s,video:o,event:n,custom:a},events:{"click .joms-postbox-tab-root li":"onChangeTab"},initialize:function(){this.listenTo(t,"postbox:photo",this.onOpenPhotoTab),this.listenTo(t,"postbox:video",this.onOpenVideoTab)},render:function(){var e=h.get("settings")||{},i=h.get("conf")||{};e.isAdmin&&i.enablecustoms||(this.subviews=t.omit(this.subviews,"custom")),e.isProfile&&!e.isMyProfile&&(this.subviews=t.pick(this.subviews,"status")),e.isEvent&&(this.subviews=t.omit(this.subviews,"photo","video","event")),(e.isProfile||e.isGroup)&&(i.enablephotos||(this.subviews=t.omit(this.subviews,"photo")),i.enablevideos||(this.subviews=t.omit(this.subviews,"video")),i.enableevents||(this.subviews=t.omit(this.subviews,"event"))),this.subkeys=t.keys(this.subviews),this.$subviews=this.$(".joms-postbox-tabs"),this.$tab=this.$(".joms-postbox-tab-root").hide();var s=this;this.$tab.find("li").each(function(){var e=t(this),i=e.data("tab");s.subkeys.indexOf(i)<0&&e.remove()}),this.subkeys&&this.subkeys.length&&this.changeTab(this.subkeys[0])},show:function(){this.$el[t.isMobile?"show":"fadeIn"]()},changeTab:function(e){if(this.subviews[e]){var i=this.$tab.find("li[data-tab="+e+"]");i&&i.length&&(i.hasClass("active")||i.addClass("active"),i.siblings(".active").removeClass("active")),this.subflags[e]||this.initSubview(e);for(var s in this.subflags)s!==e&&this.subviews[s].hide();this.subviews[e].show(),t.trigger("postbox:tab:change",e)}},onChangeTab:function(e){this.changeTab(t(e.currentTarget).data("tab"))},onOpenPhotoTab:function(){this.changeTab("photo")},onOpenVideoTab:function(){this.changeTab("video")},onShowInitialState:function(){this.subkeys.length>1&&this.$tab.show()},onShowMainState:function(){this.$tab.hide()},initSubview:function(t){this.subflags[t]||(this.subviews[t]=new this.subviews[t]({single:this.subkeys.length<=1}),this.assign(this.getSubviewElement(),this.subviews[t]),this.listenTo(this.subviews[t],"show:initial",this.onShowInitialState),this.listenTo(this.subviews[t],"show:main",this.onShowMainState),this.subflags[t]=!0)},getSubviewElement:function(){var e=t("<div>").hide().appendTo(this.$subviews);return e}})}),define("views/stream/filterbar",["sandbox","views/base"],function(t,e){return e.extend({render:function(){this.$btn=t(".joms-activity-filter-action"),this.$list=t(".joms-activity-filter-dropdown"),this.$chk=this.$list.find(".joms-icon-checkbox-unchecked").closest("li"),this.$label=t(".joms-activity-filter-status"),this.$btn.on("click",t.bind(this.toggle,this)),this.$list.on("click","li",t.bind(this.select,this)),this.listenTo(t,"click",this.onDocumentClick)},toggle:function(){var t="none"===this.$list[0].style.display;t?this.expand():this.collapse()},expand:function(){this.$list.show()},collapse:function(){this.$list.hide()},select:function(e){var i,s="",o=t(e.currentTarget),n=o.data(),a=o.find("i");a.length&&(i=!!a.hasClass("joms-icon-checkbox-checked"));var h=[];for(var r in n)h.push(r+"="+n[r]);h=h.join("&"),s+=h?"?"+h:"",this.toggle(),window.location=s},onDocumentClick:function(t){t.closest(".joms-activity-filter").length||this.collapse()}})}),define("views/stream/item",["sandbox","views/base","utils/constants","utils/language"],function(t,e,i,s){return e.extend({el:"#activity-stream-container",events:{"click .dropdown-menu a[data-action=edit]":"onEditStream","click .dropdown-menu a[data-action=remove-tag]":"onRemoveStreamTag","click [data-type=stream-editor] [data-action=cancel]":"onEditStreamCancel","click [data-type=stream-editor] [data-action=save]":"onEditStreamSave","click [data-type=stream-action] [data-action=comment]":"onCommentStreamAdd","click [data-type=stream-comments] [data-action=reply]":"onCommentStreamAdd","click [data-type=stream-newcomment] [data-action=cancel]":"onCommentStreamAddCancel","click [data-type=stream-newcomment] [data-action=save]":"onCommentStreamAddSave","click [data-type=stream-comment] [data-action=edit]":"onCommentStreamEdit","click [data-type=stream-comment] [data-action=cancel]":"onCommentStreamEditCancel","click [data-type=stream-comment] [data-action=save]":"onCommentStreamEditSave","click [data-type=stream-comment] [data-action=remove]":"onCommentStreamRemove","click [data-type=stream-comment] [data-action=remove-tag]":"onCommentStreamRemoveTag"},onEditStream:function(e){e.preventDefault();var i=t(e.target),s=this.getContainer(i),o=s.children("[data-type=stream-content]"),n=s.children("[data-type=stream-editor]");n.is(":visible")||(o.hide(),n.show(),this.resetStreamEditor(n),this.focusTextarea(n))},onEditStreamCancel:function(t){t.preventDefault();var e=this.getContainer(t.target),i=e.children("[data-type=stream-content]"),s=e.children("[data-type=stream-editor]");s.is(":visible")&&(s.hide(),i.show())},onEditStreamSave:function(t){t.preventDefault();var e,i=this.getContainer(t.target),s=i.children("[data-type=stream-editor]"),o=this;s.is(":visible")&&(e=s.find("textarea"),e.textntags("val",function(t){joms.stream.ajaxSaveStatus(o.getStreamId(i),t),s.hide()}))},onCommentStreamAdd:function(t){t.preventDefault();var e=this.getContainer(t.target),i=e.find("[data-type=stream-newcomment]");i.is(":visible")||(i.show(),this.resetStreamEditor(i,!0),this.focusTextarea(i),this.hideAddCommentButton(e))},onCommentStreamAddCancel:function(t){t.preventDefault();var e=this.getContainer(t.target),i=e.find("[data-type=stream-newcomment]");i.is(":visible")&&(i.data("saving")||(i.hide(),this.showAddCommentButton(e)))},onCommentStreamAddSave:function(e){e.preventDefault();var i,s=t(e.target),o=this.getContainer(e.target),n=o.find("[data-type=stream-newcomment]"),a=this;n.is(":visible")&&(n.data("saving")||(n.data("saving",1),s.data("label",s.text()),s.html("Saving..."),s.prop("disabled",!0),i=n.find("textarea"),i.textntags("val",function(e){jax.doneLoadingFunction=function(){jax.doneLoadingFunction=t.noop,n.removeData("saving"),s.html(s.data("label")),s.prop("disabled",!1)},jax.call("community","system,ajaxStreamAddComment",a.getStreamId(o),e)})))},onCommentStreamEdit:function(e){e.preventDefault();var i=t(e.target),s=this.getContainer(e.target),o=i.closest("[data-type=stream-comment-content]"),n=o.siblings("[data-type=stream-comment-editor]"),a=s.find("[data-type=stream-newcomment]");n.is(":visible")||(a.hide(),o.hide(),n.show(),this.resetStreamEditor(n,!0),this.focusTextarea(n),this.hideAddCommentButton(s))},onCommentStreamEditCancel:function(e){e.preventDefault();var i=t(e.target),s=this.getContainer(e.target),o=i.closest("[data-type=stream-comment-editor]"),n=o.siblings("[data-type=stream-comment-content]");o.is(":visible")&&(o.data("saving")||(o.hide(),n.show(),this.showAddCommentButton(s)))},onCommentStreamEditSave:function(e){e.preventDefault();var i,s=t(e.target),o=this.getContainer(e.target),n=s.closest("[data-type=stream-comment-editor]"),a=n.siblings("[data-type=stream-comment-content]"),h=this;n.is(":visible")&&(n.data("saving")||(n.data("saving",1),s.data("label",s.text()),s.html("Saving..."),i=n.find("textarea"),i.textntags("val",function(e){var i=n.closest("[data-type=stream-comment]").data("commentid");jax.doneLoadingFunction=function(){jax.doneLoadingFunction=t.noop,n.removeData("saving"),s.html(s.data("label"))},jax.call("community","system,ajaxeditComment",i,e,h.getStreamId(o))}),n.hide(),a.show(),this.showAddCommentButton(o)))},onCommentStreamRemove:function(e){e.preventDefault();var i,o=this;i=t(['<div><button class="btn" onclick="cWindowHide();">',s.get("no"),'</button><button class="btn btn-primary pull-right">',s.get("yes"),"</button></div>"].join("")),i.on("click",".btn-primary",function(){o.onCommentStreamRemoveConfirm(e),window.cWindowHide()}),window.cWindowShow(null,s.get("stream.remove_comment"),450,100),window.cWindowAddContent("<div>"+s.get("stream.remove_comment_message")+"</div>",i)},onCommentStreamRemoveConfirm:function(e){var i=this.getContainer(e.target),s=this;jax.loadingFunction=t.noop,jax.doneLoadingFunction=function(){jax.doneLoadingFunction=t.noop;var e,o=i.find("[data-type=stream-more]"),n=o.find(".wall-cmt-count");o&&o.length&&(e=+n.text(),e>1?n.text(e-1):o.remove()),s.showAddCommentButton(i)},jax.call("community","system,ajaxStreamRemoveComment",t(e.target).data("id"))},onRemoveStreamTag:function(e){e.preventDefault();var s,o=t(e.target),n=this.getContainer(o),a=n.children("[data-type=stream-editor]"),h=a.find("textarea"),r=h.data("original")||h.val(),l=i.get("uid");l&&(s=this.getTagFromUid(r,l),s&&jax.call("community","activities,ajaxRemoveUserTag",this.getStreamId(n),s,"post"))},onCommentStreamRemoveTag:function(e){e.preventDefault();var s,o=t(e.target),n=o.closest("[data-type=stream-comment-content]"),a=n.siblings("[data-type=stream-comment-editor]"),h=a.find("textarea"),r=h.data("original")||h.val(),l=i.get("uid");l&&(s=this.getTagFromUid(r,l),s&&jax.call("community","activities,ajaxRemoveUserTag",a.closest("[data-type=stream-comment]").data("commentid"),s,"comment"))},getStreamId:function(e){return t(e).closest("li[data-streamid]").data("streamid")},getContainer:function(e){return t(e).closest("li[data-streamid]").children(".joms-stream-content")},getTagFromUid:function(t,e){if(!t||!e)return!1;var i=new RegExp("@\\[\\["+e+":contact:[^\\]]+\\]\\]"),s=t.match(i);return s&&s[0]},focusTextarea:function(t){var e,i;e=t.find("textarea").focus(),e=e[0],e&&e.setSelectionRange&&(i=e.value.length,e.setSelectionRange(i,i))},hideAddCommentButton:function(t){var e=t.find("[data-type=stream-action] [data-action=comment]"),i=t.find("[data-type=stream-reply]");e.hide(),i.hide()},showAddCommentButton:function(t){var e=t.find("[data-type=stream-action] [data-action=comment]"),i=t.find("[data-type=stream-reply]"),s=i.siblings("[data-type=stream-comment]").length,o=i.siblings("[data-type=stream-more]").length;e[s||o?"hide":"show"](),i[s||o?"show":"hide"]()},resetStreamEditor:function(e,i){var s=t(e).find("textarea"),o=s.data("initialized");o||(s.data("original",s.val()),s.data("initialized",1),this.initTextntags(s,i)),s.textntags("val",s.data("original"))},initTextntags:function(e,s){var o=this;e.textntags({triggers:{"@":{uniqueTags:!0,minChars:1}},onDataRequest:function(n,a,h,r){var l="index.php?option=com_community&view=friends&task=ajaxAutocomplete&streamid="+o.getStreamId(e),d=i.get("settings");d.isGroup?l+="&groupid="+i.get("groupid"):d.isEvent&&(l+="&eventid="+i.get("eventid")),o.fetchTextntags&&o.fetchTextntags.abort(),o.fetchTextntags=t.ajax({url:l+"&query="+a+(s?"&type=comment":""),dataType:"json",success:function(e){var i,s=[];if(e&&e.suggestions&&e.suggestions.length){for(i=0;i<e.suggestions.length;i++)s.push({id:e.data[i],name:e.suggestions[i],avatar:e.img[i].replace(/^.+src="([^"]+)".+$/,"$1"),type:"contact"});a=a.toLowerCase(),s=t.filter(s,function(t){return t.name.toLowerCase().indexOf(a)>-1}),r.call(this,s)}},complete:function(){o.fetchTextntags=!1}})}})}})}),define("views/stream/layout",["sandbox","views/base","views/stream/filterbar","views/stream/item"],function(t,e,i,s){return e.extend({initialize:function(){this.filterbar=new i,this.item=new s},render:function(){this.filterbar.render(),this.item.render(),t(document).on("click",".dropdown-menu li a",function(){var e=t(this),i=e.closest(".joms-privacy-dropdown"),s=i.find(".dropdown-toggle").find("i"),o=i.prev(".joms-share-privacy");s&&s.length&&s.attr("class",e.find("i").attr("class")),o&&o.length&&o.html(e.find("span").html())})}})}),define("views/header/layout",["sandbox","views/base"],function(t,e){return e.extend({render:function(){this.onResize(),t(window).on("resize",this.onResize)},onResize:function(){var e,i,s=t(".js-focus-cover"),o=s.children("img"),n=o.position()||{};n.top&&(e=o.height(),i=o.data("ratio"),i||(i=Math.abs(n.top)/e,o.data("ratio",i)),o.css({top:0-i*e}))}})}),require(["sandbox","views/postbox/layout","views/stream/layout","views/header/layout"],function(t,e,i,s){function o(){var i,s=t(".joms-postbox");s.length&&(i=new e({el:s}),i.render(),i.show())}function n(){var t=new i;t.render()}function a(){var t=new s;t.render()}t(function(){o(),n(),a()})}),define("init",function(){}),require.config({urlArgs:"bust="+(new Date).getTime(),deps:["init"]}),define("bundle",function(){});
//# sourceMappingURL=bundle.js.map